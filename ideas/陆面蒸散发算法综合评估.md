# 陆面蒸散发算法综合评估：用于Python库开发的科学与数学纲要

## 目录

[TOC]

------



日期： 2024年5月20日

致： ET模拟库项目负责人

来自： R. Tang博士，水文模拟与遥感首席研究科学家

保密级别： 仅供内部研发使用

------



### **执行摘要：一个统一蒸散发Python库的框架**



本报告为开发一个全面的、面向对象的Python库提供了科学、数学和算法基础，该库旨在模拟和比较全球陆面蒸散发（ET）模型。为满足用户对详尽、专家级分析的需求，本报告综合了过去十年（约2015-2025年）的重要SCI期刊文献，重点关注基础算法、数学公式和关键的不确定性领域。

来自所提供研究材料 1 的发现和分析构建为四个部分：

1. **第一部分：算法分类法与产品清单。** 我们将您研究中提到的50多种ET产品 1 这一混乱的局面，系统地解构为五个不同的“算法家族”。这种分类法可作为面向对象库的概念“基类”。本部分最终形成了 **表1**，这是一个主清单，将约20个关键的全球产品（MOD16, GLEAM, PML-V2, SSEBop, ERA5-Land, FLUXCOM等）映射到它们的核心算法、组分拆分能力和分辨率。
2. **第二部分：数学与理论基础。** 根据您的直接要求，本节提供了每个算法家族核心算法的详细、大学一年级水平的数学推导。我们展示了Penman-Monteith（P-M）阻力模型（MOD16, PML-V2）、Priestley-Taylor（P-T）胁迫模型（GLEAM, PT-JPL）和地表能量平衡（SEB）残差模型（SEBAL, SSEBop）的逐步逻辑。我们还提供了关键的潜在ET（PET）公式（FAO-56, Hargreaves, Thornthwaite）的比较推导。本节内容旨在可以直接转换为Python函数和方法。
3. **第三部分：前沿分析与研究进展。** 本节综合了近期综述论文 1 的高层结论。它关注您指出的两个关键领域：
   - **T/ET 拆分问题：** 我们分析了组分拆分（蒸腾 $T$、土壤蒸发 $E_s$、冠层截留 $E_i$）的“黑箱”，解释了全球T/ET比率存在“惊人的”0.24至0.90不确定性范围 3 的来源，并提供了 **表3**，详细说明了关键产品（GLEAM, PML-V2, ETMonitor, ERA5-Land）如何执行这种分离。
   - **验证与不确定性：** 我们讨论了“没有单一最佳产品”的共识 1，并探讨了您指出的关键“验证陷阱” 1：为点尺度FLUXNET验证而优化的产品（如FLUXCOM）在流域尺度的水量平衡闭合上常常失败 1。
4. **第四部分：Python库生成提示词。** 最终的交付成果是一个全面、结构化的提示词，用于代码生成LLM（如Claude, Codex），它将所有发现综合为一个请求，以生成库的Python代码框架，包括类结构、方法和模拟脚本。

本报告旨在作为您的软件开发项目的主要科学和技术规范。

------



### **第一部分：全球蒸散发（ET）产品与算法的比较分析**



构建一个统一的ET库，其主要挑战在于管理现有产品的高度多样性。您自己的“构思”文件 1 正确地识别了超过50个潜在的数据集。一个健壮的库必须对这种复杂性进行抽象。文献 1 表明，这些产品并非50种独特的方法，而是大约5个具有不同参数化方案的“算法家族”。这种分类法为您库的面向对象结构提供了自然的框架。



#### **1.1. 算法家族：一个基础分类法**



我们根据其核心求解逻辑将所有AET产品分为五大家族。

##### 1.1.1. 基于 Penman–Monteith (P-M) 的模型：阻力模型

- **核心概念：** 该家族基于Penman-Monteith (P-M) 组合方程 4，这是一个物理上完备的模型，将ET视为一个类似于电路的过程。ET被能量梯度“驱动”，并受到一系列阻力的“限制”。这些模型的全部目标是找到两个最关键参数的值：**空气动力学阻力 ($r_a$)** 和 **地表阻力 ($r_s$)** 6。
- **关键产品：** MOD16, PML-V2。
- **意义：** 这是应用最广泛的物理-生物模型，因为地表阻力 ($r_s$) 提供了与植物生理学（即气孔控制）的直接联系 7。该算法的复杂性完全在于如何参数化 $r_s$ 和 $r_a$。

##### 1.1.2. 基于 Priestley–Taylor (P-T) 的模型：胁迫模型

- **核心概念：** 该家族使用P-M方程的简化、基于辐射的版本 8。它计算一个 *潜在* ET（在无限水量下 *可能* 发生的ET），然后使用一个“胁迫因子”（通常是0到1之间的数字，常表示为修正的 $\alpha$ 系数）将其缩减为 *实际* ET，该因子考虑了水分短缺、温度和植被健康状况。
- **关键产品：** GLEAM, PT-JPL, ECOSTRESS。
- **意义：** 这种方法高度模块化。其强大之处在于寻找“胁迫因子”的方法多种多样。GLEAM使用微波卫星数据（土壤湿度和VOD）1，而PT-JPL使用基于温度、湿度和植被指数的生态生理“约束函数”($f$-因子) 10。

##### 1.1.3. 基于地表能量平衡 (SEB) 的模型：残差模型

- **核心概念：** 该家族将ET（作为潜热 $LE$）视为地表能量的“剩余”部分。它基于地表能量平衡方程：$LE = R_n - G - H$ 12。整个算法致力于准确估算其他三个分量，尤其是 **感热通量 ($H$)**（用于加热空气的能量）。
- **关键产品：** SEBAL, METRIC, SSEBop。
- **意义：** 这些模型严重依赖热红外遥感（地表温度，LST）。它们的关键创新在于“自我校准”程序，该程序使用图像中的“热”和“冷”像素来求解 $H$，从而绕过了对复杂的、逐像素的空气温度和阻力数据的需求 14。

##### 1.1.4. 陆面模型 (LSM)：物理模型

- **核心概念：** 这些不是单一方程的遥感算法，而是复杂的、多层的物理模型（例如H-TESSEL, Noah, Catchment），它们在网格单元内模拟完整、耦合的水和能量收支。它们是全球气候模型和再分析系统的“陆地部分” 1。
- **关键产品：** ERA5-Land (H-TESSEL模型), GLDAS (驱动Noah, VIC, CLSM模型), MERRA-2 (Catchment LSM) 1。
- **意义：** LSMs提供的输出在**空间和时间上是完整的**（没有云层间隙）并且**物理上一致**（即它们的水量平衡是闭合的；P - ET - R = $\Delta$S）。如验证研究所示 1，它们在 *点尺度*（与FLUXNET相比）表现不佳，但在 *流域尺度*（与水量平衡相比）表现出色，这证明了它们在大型水文分析中的实用性。

##### 1.1.5. 数据驱动与混合模型：集成模型

- **核心概念：** 这个新兴家族使用先进的统计、机器学习（ML）或数据融合技术来生成“最佳猜测”产品。这主要通过两种方式实现：
  1. **升尺度：** 使用ML（例如随机森林、神经网络）将点基准的FLUXNET数据升尺度到全球网格，使用遥感/气候数据作为预测因子 1。
  2. **融合：** 使用数据融合技术（例如贝叶斯模型平均（BMA）、加权平均）来合并多个现有的遥感和LSM产品 1。
- **关键产品：** FLUXCOM (升尺度), GLASS (BMA融合), DOLCE (加权融合), REA, SGAN, CAMELE 1。
- **意义：** 这是当前的研究前沿。综述研究 1 一致表明，这些产品在与 *FLUXNET站点* 验证时具有最高的准确性，因为它们被明确训练或加权以匹配这些观测值。



#### 1.2. 表1：全球 AET 产品与算法清单



表1. 全球 AET 产品与算法家族映射。该表构成 Python 库的基础“数据库模式”，将具体产品（拟实现的具体类）与抽象算法家族（基类）及其 ET 组分拆分能力关联。见正文 1.1 节获得家族定义；组分列中“是”表示可显式获得 T, Es, Ei 等子通量。

| **产品名称**      | **算法家族**     | **核心算法 / 模型**                     | **ET组分**                    | **空间分辨率** | **时间分辨率** | **关键参考文献 (Snippet)** |
| ----------------- | ---------------- | --------------------------------------- | ----------------------------- | -------------- | -------------- | -------------------------- |
| **MOD16 (v6.1)**  | Penman-Monteith  | P-M 结合生物群系特定阻力 (BPLUT)        | 否 (仅内部计算)               | 500m           | 8天            | Mu et al. 1                |
| **PML-V2**        | Penman-Monteith  | P-M-Leuning (GPP耦合的 $G_c$)           | **是 (T, Es, Ei)**            | 500m           | 8天            | Zhang et al. 1             |
| **GLEAM (v3.8a)** | Priestley-Taylor | P-T 结合微波VOD/SM胁迫因子              | **是 (T, Es, Ei, Ew, Esnow)** | 0.25°          | 每日           | Miralles et al. 1          |
| **PT-JPL**        | Priestley-Taylor | P-T 结合生态生理约束 ($f_T, f_M$)       | **是 (T, Es, Ei)**            | 1km (全球)     | 每月           | Fisher et al. 1            |
| **ECOSTRESS**     | Priestley-Taylor | PT-JPL (高分辨率)                       | **是 (T, Es, Ei)**            | 70m            | 每日           | Fisher et al. 1            |
| **SEBAL**         | 地表能量平衡     | SEB, $H$ 来自 "热" / "冷" 像素          | 否                            | 30m (Landsat)  | 瞬时           | Bastiaanssen et al. 1      |
| **METRIC**        | 地表能量平衡     | SEBAL 结合内部校准                      | 否                            | 30m (Landsat)  | 瞬时           | Allen et al. 1             |
| **SSEBop**        | 地表能量平衡     | SEB 结合 "ET分数" ($ET_f$) (来自LST)    | 否 (总AET)                    | 1km            | 每日/每月      | Senay et al. 1             |
| **BESS**          | 混合 (P-M/过程)  | Breathing Earth System Simulator (耦合) | 否 (总AET)                    | 1km            | 8天            | Jiang & Ryu 1              |
| **ETMonitor**     | 混合 (P-M/过程)  | Shuttleworth-Wallace + Gash 截留模型    | **是 (T, Es, Ei, Ew, Esnow)** | 1km            | 每日           | Zheng et al. 1             |
| **ERA5-Land**     | 陆面模型         | H-TESSEL LSM (再分析)                   | **是 (T, Es, Ei, Esnow)**     | 0.1° (~9km)    | 每小时         | Hersbach et al. 1          |
| **GLDAS (v2.1)**  | 陆面模型         | 离线 LSMs (Noah, VIC, CLSM)             | **是 (LSM依赖)**              | 0.25°          | 3小时          | Rodell et al. 1            |
| **MERRA-2**       | 陆面模型         | GEOS-5 / Catchment LSM (再分析)         | **是 (LSM内部)**              | 0.5° x 0.625°  | 每小时         | Gelaro et al. 1            |
| **FLUXCOM**       | 机器学习         | ML 升尺度 FLUXNET 数据 (MTE, RF, ANN)   | 否 (总AET)                    | 0.083° / 0.5°  | 8天/每月       | Jung et al. 1              |
| **FLUXCOM-X**     | 机器学习         | XGBoost 升尺度                          | **是 (T 被单独估算)**         | 0.0833°        | 每日           | 1                          |
| **GLASS**         | 混合 (融合)      | 贝叶斯模型平均 (BMA) / DNN              | 否 (总AET)                    | 1km / 0.05°    | 8天            | Yao et al. 1               |
| **DOLCE**         | 混合 (融合)      | 加权集合 (GLEAM, MOD16, PML等)          | 否 (总AET)                    | 0.25°          | 每月           | Hobeichi et al. 1          |
| **TerraClimate**  | 混合 (WB模型)    | Thornthwaite-Mather 水平衡              | 否 (总AET)                    | 4km            | 每月           | Abatzoglou et al. 1        |

> 注：表1引用见正文“第一部分”相关小节；可在程序中用作元数据注册表。

| **产品名称**      | **算法家族**     | **核心算法 / 模型**                     | **ET组分**                    | **空间分辨率** | **时间分辨率** | **关键参考文献 (Snippet)** |
| ----------------- | ---------------- | --------------------------------------- | ----------------------------- | -------------- | -------------- | -------------------------- |
| **MOD16 (v6.1)**  | Penman-Monteith  | P-M 结合生物群系特定阻力 (BPLUT)        | 否 (仅内部计算)               | 500m           | 8天            | Mu et al. 1                |
| **PML-V2**        | Penman-Monteith  | P-M-Leuning (GPP耦合的 $G_c$)           | **是 (T, Es, Ei)**            | 500m           | 8天            | Zhang et al. 1             |
| **GLEAM (v3.8a)** | Priestley-Taylor | P-T 结合微波VOD/SM胁迫因子              | **是 (T, Es, Ei, Ew, Esnow)** | 0.25°          | 每日           | Miralles et al. 1          |
| **PT-JPL**        | Priestley-Taylor | P-T 结合生态生理约束 ($f_T, f_M$)       | **是 (T, Es, Ei)**            | 1km (全球)     | 每月           | Fisher et al. 1            |
| **ECOSTRESS**     | Priestley-Taylor | PT-JPL (高分辨率)                       | **是 (T, Es, Ei)**            | 70m            | 每日           | Fisher et al. 1            |
| **SEBAL**         | 地表能量平衡     | SEB, $H$ 来自 "热" / "冷" 像素          | 否                            | 30m (Landsat)  | 瞬时           | Bastiaanssen et al. 1      |
| **METRIC**        | 地表能量平衡     | SEBAL 结合内部校准                      | 否                            | 30m (Landsat)  | 瞬时           | Allen et al. 1             |
| **SSEBop**        | 地表能量平衡     | SEB 结合 "ET分数" ($ET_f$) (来自LST)    | 否 (总AET)                    | 1km            | 每日/每月      | Senay et al. 1             |
| **BESS**          | 混合 (P-M/过程)  | Breathing Earth System Simulator (耦合) | 否 (总AET)                    | 1km            | 8天            | Jiang & Ryu 1              |
| **ETMonitor**     | 混合 (P-M/过程)  | Shuttleworth-Wallace + Gash 截留模型    | **是 (T, Es, Ei, Ew, Esnow)** | 1km            | 每日           | Zheng et al. 1             |
| **ERA5-Land**     | 陆面模型         | H-TESSEL LSM (再分析)                   | **是 (T, Es, Ei, Esnow)**     | 0.1° (~9km)    | 每小时         | Hersbach et al. 1          |
| **GLDAS (v2.1)**  | 陆面模型         | 离线 LSMs (Noah, VIC, CLSM)             | **是 (LSM依赖)**              | 0.25°          | 3小时          | Rodell et al. 1            |
| **MERRA-2**       | 陆面模型         | GEOS-5 / Catchment LSM (再分析)         | **是 (LSM内部)**              | 0.5° x 0.625°  | 每小时         | Gelaro et al. 1            |
| **FLUXCOM**       | 机器学习         | ML 升尺度 FLUXNET 数据 (MTE, RF, ANN)   | 否 (总AET)                    | 0.083° / 0.5°  | 8天/每月       | Jung et al. 1              |
| **FLUXCOM-X**     | 机器学习         | XGBoost 升尺度                          | **是 (T 被单独估算)**         | 0.0833°        | 每日           | 1                          |
| **GLASS**         | 混合 (融合)      | 贝叶斯模型平均 (BMA) / DNN              | 否 (总AET)                    | 1km / 0.05°    | 8天            | Yao et al. 1               |
| **DOLCE**         | 混合 (融合)      | 加权集合 (GLEAM, MOD16, PML等)          | 否 (总AET)                    | 0.25°          | 每月           | Hobeichi et al. 1          |
| **TerraClimate**  | 混合 (WB模型)    | Thornthwaite-Mather 水平衡              | 否 (总AET)                    | 4km            | 每月           | Abatzoglou et al. 1        |



------



### **第二部分：数学与理论基础（面向大学一年级水平的解释）**



本部分旨在满足您对详细数学解释的需求，这些解释适用于刚入学的大学新生。这些公式构成了您需要在Python类中实现的核心方法。



#### **2.1. Penman-Monteith (P-M) 家族**



##### 2.1.1. 组合方程 (The "Parent" Formula)

- **概念：** P-M方程被称为“组合方程”，因为它将两个问题组合在一个解中：

  1. **能量问题：** 你需要能量（辐射）将液态水转化为蒸汽。这是**辐射项**。
  2. **传输问题：** 你需要将水蒸气从地表带走（利用风和湿度梯度）。这是**空气动力学项**。

- 公式 (来自 4):

  

  $$
  LE \;=\; \frac{\Delta\,(R_n - G) + \rho c_p \,\dfrac{(e_s - e_a)}{r_a}}{\Delta + \gamma \left( 1 + \dfrac{r_s}{r_a} \right)} \tag{1}
  $$

- **变量 (一年级水平解释):**

  - $LE$: **潜热通量 (Latent Heat Flux)**。这就是ET，但以能量单位（瓦特/平方米）表示。它是我们要解的“答案”。
  - $R_n$: **净辐射 (Net Radiation)**。来自太阳的总可用能量，减去反射回太空的部分。它是ET的“引擎”。
  - $G$: **土壤热通量 (Soil Heat Flux)**。进入土壤使其变暖的能量。$R_n - G$ 是可用于加热空气或蒸发水分的“可用能量”。
  - $e_s - e_a$: **饱和水汽压差 (Vapor Pressure Deficit, VPD)**。这是空气的“渴度”。$e_s$ 是空气能容纳的*最大*水分（饱和状态），$e_a$ 是它*实际*容纳的水分。差值越大，意味着空气越“渴”。
  - $\rho c_p$: **空气密度和比热**。一个“辅助”常数，将“渴度”(VPD) 转换为能量项。
  - $\Delta$ (Delta): **饱和水汽压曲线的斜率**。一个高级术语，表示如果温度升高1°C，空气能多容纳多少水蒸气。它很重要，因为它控制着能量如何在加热空气（感热）和蒸发水分（潜热）之间分配。
  - $\gamma$ (Gamma): **干湿表常数 (Psychrometric Constant)**。另一个“辅助”常数，将气压与蒸发所需的能量联系起来。
  - $r_a$: **空气动力学阻力 (Aerodynamic Resistance) (s/m)**。“传输问题”的阻力。它衡量将水蒸气从叶片/土壤表面移动到上方空气中的难度。高风速 = 低 $r_a$。光滑表面（如裸土）= 高 $r_a$。粗糙表面（如森林）= 低 $r_a$。
  - $r_s$: **地表阻力 (Surface Resistance) (s/m)**。“地表问题”的阻力。它衡量水从地表排出的难度。对植物而言，这是**气孔 (stomata)**（叶片上的微小孔隙）的阻力。气孔开放 = 低 $r_s$。气孔关闭（由于干旱）= 高 $r_s$。对裸土而言，这是土壤孔隙的阻力。湿润土壤 = 低 $r_s$。干燥土壤 = 高 $r_s$。

- **关键点：** 所有的P-M*模型*（如MOD16, PML-V2）都只是计算两个最困难变量 $r_a$ 和 $r_s$ 的不同且复杂的“配方”。

##### 2.1.2. MOD16 算法：求解阻力 ($r_a$ 和 $r_s$)

- **目标：** 使用MODIS卫星数据（如LAI和土地覆盖）以及再分析气象数据（如气温和湿度）计算 $r_a$ 和 $r_s$。
- **空气动力学阻力 ($r_a$)** 5:
  - MOD16 将 $r_a$ 视为两个平行阻力：$r_h$ (对流热传输) 和 $r_r$ (辐射热传输)。
  - $$r_a = \frac{r_h \cdot r_r}{r_h + r_r}$$
  - $r_h = \frac{1}{g_{lbl}}$ (其中 $g_{lbl}$ 是叶片尺度的边界层导度，一个来自BPLUT的生物群系特定值)。
  - $r_r = \frac{\rho c_p}{4 \sigma (T_K^3)}$ (其中 $\sigma$ 是 Stefan-Boltzmann 常数， $T_K$ 是开尔文温度)。
  - **解释：** 这是一个基于物理的计算，描述热量如何从叶片转移走，既包括通过空气分子碰撞（对流），也包括叶片辐射热量（辐射）。
- **地表阻力 ($r_s$)** 7:
  - **关键点：** 这是MOD16的“秘方”。它*不是*一个简单的方程，而是一个“复杂的逻辑问题”，它将ET分为三个部分（蒸腾、土壤蒸发、冠层截留蒸发），并为每个部分计算阻力。
  - **概念逻辑 (一年级水平):**
    1. **冠层是否湿润？** (是否在下雨？)
       - **是：** 蒸发发生在湿润的叶片上。$r_s$ 被设为一个非常低的值（易于蒸发）。
    2. **否，冠层干燥：** ET是蒸腾（来自植物）和土壤蒸发（来自地面）的混合。
    3. **蒸腾阻力 ($r_c$):** 这是根据*气孔导度* ($g_s$) 计算的。
       - $r_c = 1 / G_c$ (其中 $G_c$ 是冠层导度)。
       - $G_c$ 是通过 $g_s$ 乘以MODIS的**叶面积指数 (LAI)** 来估算的 ($G_c \approx g_s \times LAI$)。
       - $g_s$ (气孔导度) 本身是根据一个*最大可能*导度（来自一个称为 **Biome-Property-Lookup-Table, BPLUT** 的大型查找表 7）计算的，这个值会根据环境胁迫因子*降低*：
         - 胁迫1：高VPD (空气非常“渴”) $\rightarrow$ 气孔关闭 $\rightarrow$ $g_s$ 下降。
         - 胁迫2：低最低气温 ($T_{min}$) $\rightarrow$ 植物寒冷/休眠 $\rightarrow$ 气孔关闭 $\rightarrow$ $g_s$ 下降。
    4. **土壤蒸发阻力 ($r_{soil}$):** 这是根据土壤湿度计算的，而MOD16通过空气的相对湿度和VPD来*推断*土壤湿度。（这是一个主要的简化，也是不确定性的来源）。
    5. **最终的 $r_s$:** 模型将 $r_c$ 和 $r_{soil}$（作为平行阻力）结合起来，得到最终的“总”地表阻力，代入P-M主方程。

##### 2.1.3. PML-V2 算法：用于冠层导度 ($G_c$) 的 Leuning 模型

- **目标：** PML-V2通过使用更复杂的“双叶”P-M模型（分离冠层和土壤）以及一个更好的冠层导度 ($G_c$，即 $r_s$ 的倒数) 公式来改进MOD16。
- **PML 双项方程** (来自 19):
  - $$LE = LE_c + LE_s \tag{2}$$
  - **冠层蒸腾 ($LE_c$):**
    $$
    LE_c = \frac{\Delta \, A_c + (\rho \, c_p) \, D_a \, G_a}{\Delta + \gamma \left( 1 + \dfrac{G_a}{G_c} \right)} \tag{2a}
    $$
  - **土壤蒸发 ($LE_s$):**
    $$
    LE_s = \frac{f \, \Delta \, A_s}{\Delta + \gamma} \tag{2b}
    $$
- **变量 (一年级水平):**
  - $LE_c, LE_s$: 来自**冠层**和**土壤**的潜热。该方程*自然地*拆分了ET。
  - $A_c, A_s$: **冠层**和**土壤**处的可用能量。$R_n$ 使用LAI在两者之间分配。
  - $D_a$: 冠层处的VPD。
  - $G_a$: 空气动力学导度 ( $r_a$ 的倒数)。
  - $f$: 土壤蒸发的胁迫因子，基于土壤湿度。
  - $G_c$: **冠层导度**。这是关键。
- **Leuning 冠层导度 ($G_c$)** 21:
  - **关键点：** “Leuning”模型的精妙之处在于它将ET与**光合作用 (GPP)** *耦合* 起来。它假设植物是“智能的”，它们只打开气孔 ($G_c$) 来吸收 $CO_2$ 进行光合作用。水分损失 (ET) 是“呼吸” $CO_2$ 的*代价*。
  - **概念公式：**
    - $$G_c \approx g_0 + \frac{k \cdot GPP}{(C_s - \Gamma) \cdot (1 + D_a / D_0)}$$  
  - **解释：** 冠层导度 ($G_c$) 是一个基础导度 ($g_0$) 加上一个与植物光合作用量 (GPP) 相关的项。它受到叶片表面 $CO_2$ 浓度 ($C_s$) 和空气“渴度” ($D_a$) 的*约束*。
  - **为何更好：** PML-V2不仅仅使用 $T_{min}$ 和 VPD（像MOD16那样），而是使用一个*机理性的植物生长模型 (GPP)* 来控制气孔。这是一个更稳健的生物物理方法。



#### **2.2. Priestley-Taylor (P-T) 家族**



##### 2.2.1. P-T 方程与 $\alpha$ 系数的推导

- **概念：** Priestley 和 Taylor (1972) 观察了 P-M 方程并做出了一个绝妙的简化。他们注意到，在广阔的湿润表面（如海洋或饱和土地）上，“空气动力学项”（风/渴度）通常约占“辐射项”（能量）的 **26%**。
- **公式** (来自 8):
  - $$
  LE = \alpha \, \frac{\Delta}{\Delta + \gamma} \, (R_n - G) \tag{3}
  $$
- **变量 (一年级水平):**
  - $LE, \Delta, \gamma, R_n, G$: 与 P-M 方程中相同。
  - $\alpha$ (alpha): **P-T 系数**。这一个数字取代了整个复杂的空气动力学项 $\rho c_p \frac{(e_s - e_a)}{r_a}$。
  - 当 $\alpha = 1.26$ (即 $1.0 + 0.26$) 时，它估算的是来自饱和表面的 *潜在* ET 9。
- **关键点：** *所有* 现代 P-T 模型（GLEAM, PT-JPL）的目标都是为 *非饱和的*、真实的陆地找到 $\alpha$ 的 *实际* 值（或等效的胁迫因子）。*实际的* $\alpha$ 几乎总是 *小于* 1.26。

##### 2.2.2. GLEAM 算法：计算蒸发胁迫因子 ($S$)

- **目标：** 找到“胁迫因子” ($S$)，将潜在ET缩减为实际ET。
- **概念公式** (基于 1):
  - $$
  LE = S \times \alpha \, \frac{\Delta}{\Delta + \gamma} \, (R_n - G) \tag{4}
  $$
- **变量 (一年级水平):**
  - $S$: **蒸发胁迫因子 (Evaporative Stress Factor)** (一个0到1之间的数字)。这是GLEAM版本的 $\alpha$。$S=1$ 意味着“无胁迫”（湿润土壤）。$S=0$ 意味着“无限胁迫”（无水）。
- **$S$ 是如何计算的 (GLEAM的创新):**
  - **关键点：** GLEAM *不*像其他模型那样从气温推断胁迫，而是使用 *直接的* 卫星水体测量。
  - **对于蒸腾 (T):** GLEAM 使用来自微波卫星的 **植被光学深度 (VOD)**。VOD是衡量植物冠层总 *含水量* 的指标。低 VOD = 胁迫的植物 = 低 $S$。
  - **对于土壤蒸发 (Es):** GLEAM 使用来自微波卫星的 **地表土壤湿度 (SM)**。低 SM = 干燥土壤 = 低 $S$。
  - 这种对卫星观测水分的直接使用使GLEAM变得独特，并且通常表现出色，尤其是在数据稀缺地区 1。

##### 2.2.3. PT-JPL 算法：生态生理约束 ($f$-因子)

- **目标：** PT-JPL (Fisher et al.) 也缩减潜在ET，但它是通过分离组分 (T, Es, Ei) 并应用一系列乘法的“约束因子”（均在0到1之间）来实现的 11。

- **公式** (来自 10):

  - $$ET = T + E_s + E_i \tag{5}$$
  - $$LE_i = f_{wet} \cdot \alpha \, \frac{\Delta}{\Delta + \gamma} \, R_{nc} \tag{5a}$$
  - $$LE_s = \bigl[ f_{wet} + (1 - f_{wet}) f_{sm} \bigr] \cdot \alpha \, \frac{\Delta}{\Delta + \gamma} \, R_{ns} \tag{5b}$$
  - $$LE_T = (1 - f_{wet}) \, f_C \, f_T \, f_M \cdot \alpha \, \frac{\Delta}{\Delta + \gamma} \, R_{nc} \tag{5c}$$

  注：PT-JPL 三组分定义见式(5a)–(5c)，对应冠层截留、土壤蒸发与蒸腾。

- **变量 (一年级水平):**

  - $LE_i, LE_s, LE_T$: 来自 **冠层截留 (Interception)**、**土壤 (Soil)** 和 **蒸腾 (Transpiration)** 的潜热 (ET)。
  - $R_{nc}, R_{ns}$: 到达 **冠层 (Canopy)** 和 **土壤 (Soil)** 的净辐射（使用LAI分配）。
  - **生态生理约束 ($f$-因子):** 这些是“胁迫因子”，用于缩减潜在ET（$\alpha=1.26$ 项）。
    - $f_{wet}$: **湿润分数 (Fraction Wet)**。冠层表面有多湿？基于相对湿度 ($RH^4$)。
    - $f_{sm}$: **土壤湿度约束 (Soil Moisture Constraint)**。土壤有多大压力？基于空气的“渴度” (VPD 和 RH)。
    - $f_C$: **绿色冠层分数 (Green Canopy Fraction)**。有多少冠层是绿色的并在进行光合作用？基于植被指数 (NDVI, EVI)。
    - $f_T$: **植物温度约束 (Plant Temperature Constraint)**。植物是太热还是太冷？基于一个最佳温度 ($T_{opt}$)。
    - $f_M$: **植物水分约束 (Plant Moisture Constraint)**。植物“萎蔫”了多少（一种长期胁迫）？基于 $f_{APAR}$ (一种卫星植被指数)。

- **关键点：** ECOSTRESS 任务使用这种 PT-JPL 算法及其70米的热数据来提供高分辨率的ET 17。



#### **2.3. 地表能量平衡 (SEB) 家族**



##### 2.3.1. 残差法 (The Core Equation)

- **概念：** 这是最“原始”的物理方法。它依赖于地表的能量守恒定律。
- **公式** (来自 12):
  - $$LE = R_n - G - H \tag{6}$$
- **变量 (一年级水平):**
  - $LE$: **潜热 (ET)**。这是我们想要的“答案”。
  - $R_n$: **净辐射**。总可用能量。（可从卫星反照率和温度估算）。
  - $G$: **土壤热通量**。加热土壤的能量。（可根据植被覆盖度/NDVI估算为 $R_n$ 的一个分数）。
  - $H$: **感热通量 (Sensible Heat Flux)**。加热空气的能量。这是**最大的未知数**。SEB模型的全部目标就是找到 $H$。
- **关键点：** $H$ 的公式是 $H = \frac{\rho c_p (T_s - T_a)}{r_a}$，其中 $T_s$ 是地表温度，$T_a$ 是气温，$r_a$ 是空气动力学阻力。问题是，我们只知道 $T_s$（来自卫星热数据）。我们不知道每个像素的 $T_a$ 或 $r_a$。SEBAL 和 SSEBop 是两种不同的“技巧”，用于在不知道所有变量的情况下求解 $H$。

##### 2.3.2. SEBAL/METRIC 算法：通过 "热" 和 "冷" 像素计算 $H$

- **目标：** 在不需要每个像素的 $T_a$ 或 $r_a$ 的情况下求解 $H$ 15。
- **概念逻辑 (一年级水平):** SEBAL 15 和 METRIC 14 使用基于图像中两个“锚点”像素的“内部校准”：
  1. **找到 "冷像素" (Cold Pixel)**: 用户（或算法）找到一个冷的、湿润的像素（例如，一个完全灌溉的田地或一个湖泊）。
     - **假设：** 在此像素，所有可用能量 ($R_n - G$) 都用于ET。因此，$H_{kalt} \approx 0$。
  2. **找到 "热像素" (Hot Pixel)**: 用户找到一个热的、干燥的像素（例如，一个裸露的、干燥的田地）。
     - **假设：** 在此像素，*没有*水在蒸发 ($LE_{heiß} \approx 0$)。因此，所有可用能量必定在加热空气：$H_{heiß} = R_n - G$。
  3. **线性关系 ($dT = a \cdot T_s + b$)**: 模型假设地表与空气之间的 *温差* ($dT = T_s - T_a$) 是地表温度 ($T_s$) 的一条直线（线性函数）14。
  4. **求解直线：** 因为我们现在有了这条直线上的两个点（热像素的 $dT$ 和冷像素的 $dT$），我们可以解出斜率 ($a$) 和截距 ($b$)。
  5. **计算所有像素的 $H$：** 现在我们有了这条直线的方程，我们可以到图像中的 *任何* 像素，测量它的 $T_s$，并使用直线方程 ($dT = a \cdot T_s + b$) 来找到它特定的 $dT$。有了 $dT$，我们现在可以求解该像素的 $H$。
  6. **求解 $LE$：** 最后，对每个像素，我们使用残差方程：$LE = R_n - G - H$。

##### 2.3.3. SSEBop 算法："ET 分数" ($ET_f$) 概念

- **目标：** 简化SEB模型，使其“可操作”（自动，无需挑选像素）27。

- **核心方程** (来自 28):

  - $$ET_a = ET_f \times ETr \tag{7}$$
  - (其中 $ET_a$ 是实际ET, $ET_f$ 是ET分数, $ETr$ 是参考ET，通常是FAO-56 PET)。

- **概念逻辑 (一年级水平):** SSEBop 的目标只是找到 $ET_f$（一个0到1的值）。它通过简化热/冷像素逻辑来实现这一点 27：

  1. **参考温度：** 对于 *每个* 像素，SSEBop 使用气象数据 *计算* 一个理论上的“热”温度 ($T_h$) 和“冷”温度 ($T_c$)。
     - $T_c$ ("冷/湿极限"): 像素在完全植被覆盖并以最大速率蒸腾时 *应有的* LST（即 $ET_f = 1$）。
     - $T_h$ ("热/干极限"): 像素在完全干燥且 *没有* ET 发生时 *应有的* LST（即 $ET_f = 0$）。
  2. **获取实际 LST：** 卫星测量该像素的 *实际* 地表温度 ($T_s$)。
  3. **计算分数：** $ET_f$ 只是一个简单的线性插值：
  - $$ET_f = \dfrac{T_h - T_s}{T_h - T_c} \tag{8}$$

  - **解释：** 如果实际 $T_s$ 非常接近“冷”极限 ($T_c$)， $ET_f$ 将接近1。如果 $T_s$ 非常接近“热”极限 ($T_h$)， $ET_f$ 将接近0。

  1. **最终 $ET_a$：** 这个分数随后与一个高质量的参考ET（如 $ET_o$ 来自FAO-56）相乘，得到最终的实际ET ($ET_a$)。



#### **2.4. 潜在蒸散发 (PET) 公式**



- **概念：** PET 不是实际的ET。它是指在有 *无限* 水供应的情况下，*可能* 蒸发和蒸腾的 *最大* 水量。它是衡量大气“需求”的一个指标。您的查询明确要求进行此比较。

#### 2.4.1. 表2：PET 公式比较 (数据需求 & 原理)

- **说明：** 此表对您的库至关重要，因为PET公式通常是AET模型（如SSEBop）的依赖项，或用作基准。PET方法的选择是“数据 vs. 准确性”的经典权衡。
- **表格结构：**

表2. 常用潜在蒸散发 (PET) 公式的原理与数据需求比较。“数据 vs. 准确性”权衡明确：FAO-56 最准确；Hargreaves 适用中等数据；Thornthwaite 适合历史重建。见式(9)–(11) 获取数学形式。

| **方法名称**               | **核心原理**       | **所需输入数据**                                            | **最佳应用场景**                                             |
| -------------------------- | ------------------ | ----------------------------------------------------------- | ------------------------------------------------------------ |
| **FAO-56 Penman-Monteith** | 物理 (能量 + 传输) | **数据密集型：** $T_{max}, T_{min}, R_n, Wind, RH$          | **全球标准：** 当数据可用时，用于参考 ET ($ET_o$) 的“黄金标准” 30 |
| **Hargreaves-Samani**      | 经验 (温度 + 辐射) | **数据精简型：** $T_{max}, T_{min}, T_{mean}$, 纬度, 年积日 | **数据稀缺区：** 当只有温度数据时 31                         |
| **Thornthwaite**           | 经验 (基于温度)    | **数据极简型：** 月平均 $T_{mean}$, 纬度                    | **历史/气候研究：** 仅月温度记录的长期研究 33                |



**2.4.2. 标准方法：FAO-56 Penman-Monteith (用于参考ET, $ET_o$)**

- **概念：** 这与 2.1.1 中的 P-M 方程 *相同*，但它是为“假设的草地参考作物”*标准化*的 4。
- **标准化：** 这意味着 $r_s$ 和 $r_a$ *不是* 变量；它们是 *固定的* 常数。假设的草地高度为0.12m，固定的 $r_s$ 为 70 s/m，反照率为0.23 4。
- **公式** (来自 30):
  - $$
  ET_o = \frac{0.408\,\Delta\,(R_n - G) + \gamma \, \dfrac{900}{T + 273} \, u_2 \, (e_s - e_a)}{\Delta + \gamma \, \bigl(1 + 0.34\,u_2\bigr)} \tag{9}
  $$
- **变量：**
  - $ET_o$: **参考ET** (mm/天)。
  - $R_n, G$: 净辐射和土壤热通量 (MJ/m²/天)。
  - $T$: 2m 高处的平均气温 (°C)。
  - $u_2$: 2m 高处的风速 (m/s)。
  - $e_s - e_a$: 饱和水汽压差 (kPa)。
  - $\Delta, \gamma$: 饱和水汽压曲线斜率 (kPa/°C) 和干湿表常数 (kPa/°C)。
  - **常数 (0.408, 900, 0.34):** 这些是标准“草地”表面的固定阻力和单位换算因子。
- **意义：** 这是通用的 *基准*。实际ET通常表示为该 $ET_o$ 的一个分数。

##### 2.4.3. 基于温度的方法：Hargreaves 方程

- **概念：** 一种简单的经验公式，*仅* 使用温度估算 $ET_o$，因为它假设温度范围 ($T_{max} - T_{min}$) 是辐射和湿度的代表 31。
- **公式** (标准形式，不在 Snippets 中，但对您至关重要):
  - $$
  ET_o = 0.0023 \, \cdot \, R_a \, \cdot \, (T_{mean} + 17.8) \, \cdot \, (T_{max} - T_{min})^{0.5} \tag{10}
  $$
- **变量 (一年级水平):**
  - $ET_o$: 参考ET (mm/天)。
  - $R_a$: **地外辐射 (Extraterrestrial Radiation)** (MJ/m²/天)。这不是 *测量的* 辐射；这是大气层顶的 *理论* 辐射，纯粹由 **纬度** 和 **年积日** 计算得出。这是一个简单的几何计算。
  - $T_{mean}, T_{max}, T_{min}$: 平均、最高、最低气温 (°C)。
  - $0.0023, 17.8, 0.5$: 由 Hargreaves 和 Samani 推导出的经验常数。
- **意义：** 对数据稀缺地区极其有价值。其主要输入（温度）是应用最广泛的气候变量。

##### 2.4.4. 基于温度的方法：Thornthwaite 方程

- **概念：** 一种更简单（也更古老）的经验方法，*仅* 使用月平均温度 33。
- **概念公式** (如 33 中所述):
  - $$
  PET_{月} = 16 \, \cdot \, \left( \dfrac{10 \, \cdot \, T_{mean}}{I} \right)^a \, \cdot \, (\text{日照时数校正}) \tag{11}
  $$
- **变量 (一年级水平):**
  - $PET_{月}$: 整个月的潜在ET (cm)。
  - $T_{mean}$: 月平均气温 (°C)。
  - $I$: 一个“热量指数”，通过对12个月的温度值求和计算得出。
  - $a$: 一个复杂的指数，*取决于I*。
  - $\text{日照时数校正}$: 基于纬度和月份的校正因子。
- **意义：** 历史上很重要，并在一些水量平衡模型中（如 TerraClimate1）使用，但已在很大程度上被 Hargreaves 或 P-M 取代，因为它很“迟钝”，不对每日天气（如风或晴/阴天）作出反应 35。

------



### **第三部分：前沿分析与研究进展 (2015–2025年综述)**



本部分综合了高水平的综述论文 1 和您的高级“构思”文件 1，以解决“所以呢？”的问题：哪些产品最好？最大的问题是什么？



#### **3.1. 拆分问题：T/ET 的 "黑箱"**



##### 3.1.1. 全球 T/ET 不确定性综合

- **核心问题：** 您的文件 1 和文献 1 都将此确定为核心挑战。总ET是“生产性”用水（蒸腾 $T$，与GPP相关）和“非生产性”用水（土壤蒸发 $E_s$ + 冠层截留 $E_i$）的混合体。
- **“惊人的”不确定性：** 全球平均T/ET比率 *不是* 一个已解决的问题。综合 3 和 3，估计值在 **0.24 到 0.90**（24% 到 90%）之间剧烈波动。
- **不确定性的原因** (来自 3):
  1. **方法论差异：** 不同的方法会产生系统性差异。同位素方法（追踪水通过植物）倾向于给出 *更高* 的T/ET比率。
  2. **缺乏验证数据：** 没有“T-FLUXNET”站点。我们无法大规模地直接、分别测量 $T$, $E_s$ 和 $E_i$。树干液流 (SAPFLUXNET) 是 $T$ 的一个代理，但有其自身的尺度转换问题。
  3. **模型结构：** 模型的选择 *定义* 了拆分。单层模型（如MOD16）难以处理，而双层模型（如PML-V2）则明确求解它们。
  4. **生物复杂性：** 1 (Yang et al.) 提出了一个关键点：T/ET并 *不* 简单地随LAI增加而增加。在茂密的森林中，LAI很高（高 $T$），但 $E_i$（截留）*也* 很高，这可能 *降低* T/ET比率。这种非线性关系是一个关键挑战 1。

##### 3.1.2. 表3：关键产品中的 ET 组分 (T/ET) 拆分方法

- **说明：** 此表对您的库至关重要。如果您想比较 T/ET，您 *必须* 知道每种产品是 *如何* 计算它的。此表综合了来自 1 的数据。
- **表格结构：**

表3. 主要 ET 产品的组分拆分方法对比。显式表示模型内部直接输出各组分；隐式表示可通过公式分项求得；引用见式(2a)(2b)(5a)-(5c)。

| **产品**               | **拆分方法**    | **蒸腾 (T)**                                                 | **土壤蒸发 (Es)**                                | **冠层截留 (Ei)**                 |
| ---------------------- | --------------- | ------------------------------------------------------------ | ------------------------------------------------ | --------------------------------- |
| **GLEAM**              | 显式 (P-T)      | $S_{veg}$ (VOD) $\times$ $PET_{veg}$                         | $S_{soil}$ (微波 SM) $\times$ $PET_{soil}$       | Gash 模型 (降水驱动)              |
| **PML-V2**             | 隐式 (P-M)      | 作为 $LE_c$ 从耦合的 GPP-$G_c$ 模型中解出 (见式(2a))        | 作为 $LE_s$ 从 P-M 方程第二项解出 (见式(2b))      | 包含在 $LE_c$ (冠层蒸发)           |
| **PT-JPL / ECOSTRESS** | 显式 (P-T)      | $f_C f_T f_M \times PET_c$ (见式(5c))                        | $f_{sm} \times PET_s$ (见式(5b))                 | $f_{wet} \times PET_c$ (见式(5a)) |
| **ETMonitor**          | 显式 (混合)     | Shuttleworth-Wallace (P-M) 模型用于 T                       | Shuttleworth-Wallace 模型用于 Es                 | Gash 模型 (降水驱动)              |
| **ERA5-Land**          | 显式 (LSM)      | H-TESSEL LSM 多层阻力方案                                     | H-TESSEL 顶层土壤计算                             | H-TESSEL 冠层截留                  |
| **FLUXCOM-X**          | 显式 (ML)       | ML (XGBoost) 直接估算 T (ETT)                                | (总 ET - ETT)                                    | (总 ET - ETT)                     |

> 注：括号中的“见式”指对应的核心公式编号，便于快速回溯数学定义。

---

### 附录：符号与参数表

表 A1. 主要公式中使用的符号、物理意义与单位（按出现顺序整理）。

| 符号 | 含义 | 单位 | 备注 |
|------|------|------|------|
| $LE$ | 潜热通量 / 蒸散发能量 | W m$^{-2}$ 或 MJ m$^{-2}$ d$^{-1}$ | 公式中与水当量换算相关需除以潜热常数 |
| $R_n$ | 净辐射 | W m$^{-2}$ | 波段整合后净短波 + 净长波 |
| $G$ | 土壤热通量 | W m$^{-2}$ | 常用经验分数 $G \approx c\,R_n$ |
| $H$ | 感热通量 | W m$^{-2}$ | SEB 中未知项，通过温度差和阻力估算 |
| $e_s, e_a$ | 饱和/实际水汽压 | kPa | $e_s - e_a$ 为 VPD |
| VPD | 水汽压亏缺 | kPa | $e_s - e_a$ 简写 |
| $\rho$ | 空气密度 | kg m$^{-3}$ | 近地层取 1.2 左右 |
| $c_p$ | 空气比热容 | J kg$^{-1}$ K$^{-1}$ | 约 1004 |
| $\Delta$ | 饱和水汽压曲线斜率 | kPa °C$^{-1}$ | 温度函数 |
| $\gamma$ | 干湿表常数 | kPa °C$^{-1}$ | 约 0.066 (海平面) |
| $r_a$ | 空气动力学阻力 | s m$^{-1}$ | 与风速、粗糙度相关 |
| $r_s$ | 地表/气孔阻力 | s m$^{-1}$ | 生理胁迫、土壤水分影响 |
| $G_c$ | 冠层导度 | m s$^{-1}$ | $=1/r_c$；Leuning 模型输出 |
| $A_c, A_s$ | 冠层/土壤可用能量 | W m$^{-2}$ | $R_n$ 按 LAI / 覆盖度分配 |
| $D_a$ | 冠层处 VPD | kPa | 局地微气候差异 |
| $f$ | 土壤蒸发胁迫因子 | - | 0–1，土壤湿度控制 |
| $\alpha$ | P-T 系数 / 缩放系数 | - | 理论湿润面取 1.26 |
| $S$ | GLEAM 蒸发胁迫因子 | - | 基于 SM/VOD 求得 |
| $f_{wet}$ | 湿润分数 | - | 基于 RH 的四次函数 |
| $f_{sm}$ | 土壤湿度约束 | - | VPD + RH 综合 |
| $f_C$ | 绿色冠层分数 | - | fAPAR / fIPAR |
| $f_T$ | 温度约束 | - | 与最适温度偏差的指数函数 |
| $f_M$ | 长期水分约束 | - | fAPAR 与最大值比 |
| $ET_f$ | ET 分数 (SSEBop) | - | 介于 0–1，式(8) |
| $ETr, ET_o$ | 参考 ET | mm d$^{-1}$ | FAO-56 输出 |
| $T_c, T_h, T_s$ | 冷/热/实际地表温度 | K 或 °C | SSEBop / SEBAL 像元温度 |
| $Ra$ | 地外辐射 | MJ m$^{-2}$ d$^{-1}$ | Hargreaves 输入 |
| $PET$ | 潜在蒸散发 | mm d$^{-1}$ | 无水分限制条件 |
| LAI | 叶面积指数 | m$^{2}$ m$^{-2}$ | 冠层结构指标 |
| fAPAR | 吸收光合有效辐射分数 | - | 与生产力相关 |
| VOD | 植被光学深度 | - | 冠层含水量代理 |
| SM | 土壤湿度 | m$^{3}$ m$^{-3}$ | 表层体积含水量 |
| GPP | 总初级生产力 | g C m$^{-2}$ d$^{-1}$ | 与气孔行为耦合 |

> 注：如需在程序中统一单位换算，可将能量通量 (W m$^{-2}$) 通过除以潜热常数再乘以时间步长转换为水通量 (mm d$^{-1}$)。



#### **3.2. 过去十年的综合：验证与比对研究综述**



##### 3.2.1. 没有单一最佳产品的共识

- **关键点：** 这是所有主要综述论文 1 中最一致的发现。您的库的目标 *不* 应该是找到“最佳”模型，而应该是 *量化它们之间的差异*。
- **主要文献发现：**
  - Tang et al. 2024 1: (25 种产品) 基于ML (FLUXCOM) 和混合 (DOLCE) 的产品在 *FLUXNET 站点* 表现最佳。基于RS (MOD16等) 的产品居中。再分析 (NCEP-R2) 最差。但在 *流域尺度* 上，RS产品倾向于 *低估* ET，而再分析产品则 *高估* ET。
  - Zhu et al. 2022 1: (9 种产品) FLUXCOM 和 GLASS-MODIS 在 *站点* 具有最高技能。GLASS-AVHRR/MODIS 具有最低的 *像元不确定性* (使用 TCH)。再分析 (MERRA-2) 的不确定性最高。
  - Miralles et al. 2016 1: (WACMOS-ET 项目) P-T 模型 (GLEAM, PT-JPL) 总体表现最佳。MODIS-PM (MOD16) *持续低估* ET。SEBS *持续高估* ET。

##### 3.2.2. 验证陷阱：FLUXNET (点) vs. 水量平衡 (流域)

- **关键点：** 这是从您的“构思” 1 和验证论文 1 中综合得出的一个关键的、更高阶的认识。
- **逻辑链：**
  1. 1 和 1 表明 ML 模型 (FLUXCOM) 在与 FLUXNET 站点验证时是“最佳”的。
  2. 但 1 和 1 指出，FLUXCOM 是 *基于 FLUXNET 数据训练的*，因此这是循环验证。1 指出 FLUXCOM 在 *流域尺度*（水量平衡）上表现“较差”。
  3. 1 (Tang et al. 2024, 图5) *证明了* 这一点。FLUXCOM (RMSE $\approx$ 258) 在流域尺度上的表现 *差于* ERA5-Land (RMSE $\approx$ 200), GLDAS (RMSE $\approx$ 211), MERRA-2 (RMSE $\approx$ 212) 和 DOLCE (RMSE $\approx$ 223)。
  4. **结论：** 存在一个明显的“验证陷阱”。为 *点尺度统计* 优化的产品 (FLUXCOM) 可能在 *流域尺度物理闭合* (水量平衡) 上失败。相反，LSMs (ERA5, GLDAS) 是为 *物理闭合* 而构建的，因此在流域尺度上表现良好，即使它们在个别点上存在偏差。
  5. **启示：** 您的 Python 库 *必须* 包含两种验证方法（逐点比较和流域水量平衡），以提供一个完整的图像。



#### **3.3. 机器学习、混合化和高分辨率的兴起**



**3.3.1. 从数据驱动 (FLUXCOM) 到混合物理**

- **趋势：** 最新的文献显示，趋势正从 *纯* 物理模型（如MOD16）或 *纯* ML模型（如FLUXCOM）转向 *混合* 方法。
- **示例：**
  - **混合融合 (Hybrid-Fusion):** DOLCE, GLASS, REA, SGAN 1 合并输出，通常表现优于任何单一成员。
  - **混合物理 (Hybrid-Physics, ML-assisted):** 36 和 37 讨论了这一新前沿。ML被用于 *物理模型内部*，例如，用于推导一个参数（如GLEAM的DLBH 1）或执行数据同化 37。
  - **关键启示：** 您的库应该是模块化的以支持这一点。一个 P-T 模型类应该允许其“胁迫因子” ($S$) 通过简单的经验公式（如 PT-JPL）*或* 通过一个预训练的 ML 模型来计算。

**3.3.2. 70米前沿：ECOSTRESS 和场尺度验证**

- **数据：** 您显然对高分辨率感兴趣 1。ECOSTRESS 提供了 70m 的 ET 39。
- **算法：** ECOSTRESS L3 产品使用了 **PT-JPL 算法** 17。
- **启示与意义：** 这是您库的完美案例研究。它证明了 *算法* (PT-JPL) 与 *数据源* 是 *分离的*。您可以编写一个 `PTJPL` 类，并向其传递不同的数据：
  - `ET_global = PTJPL(data=MODIS_1km)`
  - `ET_field = PTJPL(data=ECOSTRESS_70m)`
- **验证挑战：** 您的“构思”文件 1 正确地指出，FLUXNET（几百米的足迹）是 70m 像素的 *糟糕* 基准。它提出大孔径闪烁仪 (LAS) 是正确的“路径尺度”基准。这是一个高级的见解，并证实了您的专业知识。该库应设计为能针对点 (FLUXNET)、路径 (LAS) 和流域 (水量平衡) 数据进行验证。

------



### **第四部分：交付成果：用于代码库生成的提示词**



这是您要求的综合、结构化的提示词。它旨在被复制粘贴到代码生成LLM（如Claude 3.5 Sonnet或GPT-4o）中，以构建您的Python库的基础框架。该提示词已使用本报告中确定的关键算法和结构进行了“预置”。

------

------

**任务：** 为一个用于模拟和比较陆面蒸散发（ET）模型的全面、面向对象的Python库创建骨架代码。该库必须是模块化的、可扩展的，并且能够实现水文和遥感研究中使用的各种核心算法。

**核心要求：**

1. **包结构：** 为库（例如 `py_et_lib/`）创建一个逻辑文件结构。
2. **抽象基类 (ABCs):** 将“算法家族”定义为抽象基类 (`ABCMeta`)，以强制实现一致的API。所有模型都必须实现一个 `compute_et()` 方法。
3. **具体类：** 将关键的ET模型实现为继承自相应ABC的类。
4. **模型实现：** 实现每个模型的核心公式。使用下面提供的数学公式和逻辑填充它们。
5. **PET模块：** 为常见的PET公式（FAO-56, Hargreaves）创建一个单独的模块。
6. **数据处理：** 使用 `xarray.Dataset` 作为主要的输入和输出数据结构，以本地处理时空数据。
7. **模拟脚本：** 提供一个示例脚本 (`simulation.py`)，演示如何创建一个包含模拟输入数据（例如，10x10像素，365天）的 `xarray.Dataset`，以及如何用这些数据运行每个ET模型，以进行比较分析。

------

**详细的包结构：**

```
py_et_lib/
├── __init__.py
├── core/
│   ├── __init__.py
│   ├── constants.py       # 物理常数 (gamma, lambda, sigma, 等)
│   └── base_models.py     # 抽象基类 (ABCs)
├── models/
│   ├── __init__.py
│   ├── penman_monteith.py   # MOD16, PML-V2
│   ├── priestley_taylor.py  # GLEAM, PT-JPL
│   ├── energy_balance.py    # SEBAL, SSEBop
│   ├── lsm.py               # ERA5, GLDAS 的包装器 (占位符)
│   └── pet.py               # FAO-56, Hargreaves, Thornthwaite
├── utils/
│   ├── __init__.py
│   └── validators.py      # 检查缺失输入数据的函数
└── simulation.py            # 示例模拟脚本
```

------

**详细实现：**

1. core/constants.py:

创建一个类或字典，包含必要的物理常数：

- `GAMMA`: 干湿表常数 (~0.066 kPa/°C)
- `LAMBDA_VAP`: 蒸发潜热 (~2.45 MJ/kg)
- `RHO_AIR`: 平均空气密度 (~1.225 kg/m³)
- `CP_AIR`: 空气比热 (~1004 J/kg/K)
- `STEFAN_BOLTZMANN`: Stefan-Boltzmann 常数
- ...以及公式所需的任何其他常数。

**2. `core/base_models.py`:**

Python

```
import xarray as xr
from abc import ABC, abstractmethod

class EvapotranspirationModel(ABC):
    """所有ET模型的抽象基类。"""
    
    def __init__(self, **params):
        self.params = params
        self._validate_inputs()

    @abstractmethod
    def _validate_inputs(self):
        """检查是否存在所有必需的参数。"""
        pass

    @abstractmethod
    def compute_et(self, ds: xr.Dataset) -> xr.Dataset:
        """
        计算实际ET的主方法。
        'ds' 是一个包含所有气象/遥感输入的 xarray.Dataset。
        返回一个包含 'AET' (单位 mm/Tag) 的 xarray.Dataset。
        """
        pass

    def partition_components(self, ds: xr.Dataset) -> xr.Dataset:
        """
        将ET拆分为 T, Es, Ei 的可选方法。
        如果模型不支持，则返回 'NotImplementedError'。
        """
        raise NotImplementedError(f"{self.__class__.__name__} 不支持显式的组分拆分。")

# 为每个家族定义基类
class PenmanMonteithBase(EvapotranspirationModel):...
class PriestleyTaylorBase(EvapotranspirationModel):...
class EnergyBalanceBase(EvapotranspirationModel):...
```

**3. `models/penman_monteith.py`:**

- **实现 `MOD16(PenmanMonteithBase)`:**

  - compute_et 方法必须实现完整的P-M方程：

    LE = (delta * (Rn - G) + rho * cp * (es - ea) / ra) / (delta + gamma * (1 + rs / ra))

  - 实现私有辅助方法：

    - `_compute_aerodynamic_resistance(self, ds)`: 实现 $r_a$ 逻辑 (平行阻力 $r_h, r_r$)，基于BPLUT值。
    - `_compute_surface_resistance(self, ds)`: 实现复杂的MOD16 $r_s$ 逻辑：
      1. 检查冠层是否湿润 (基于降水/RH)。
      2. 如果是，使用湿润冠层的 $r_s$。
      3. 如果否，分别计算 $r_c$ (蒸腾) 和 $r_{soil}$ (土壤)，然后合并它们。
      4. $r_c$ 必须基于 $g_s$ 的计算，该计算通过 $T_{min}$ 和 $VPD$ 胁迫因子（源自BPLUT）进行缩放。

- **实现 `PMLv2(PenmanMonteithBase)`:**

  - compute_et 方法必须实现双项PML方程 (一项用于 $LE_c$，一项用于 $LE_s$)：

    LE_c = (delta * Ac + (rho * cp) * Da * Ga) / (delta + gamma * (1 + Ga / Gc))

    LE_s = (f * delta * As) / (delta + gamma)

    LE_total = LE_c + LE_s

  - 实现 `partition_components`: 此方法简单地返回计算出的 $LE_c$ 和 $LE_s$ (转换为 mm/天)。

  - 最重要的方法是 `_compute_canopy_conductance(self, ds)`:

    - 这必须实现 Leuning 方程，该方程将 $G_c$ 与 **GPP** (总初级生产力) 耦合。
    - `GPP =...` (实现一个简单的GPP模型，例如光能利用率模型)
    - `Gc = g0 + (k * GPP) / ((Cs - Gamma) * (1 + Da / D0))`
    - 定义所有 Leuning 参数 (g0, k, D0, 等)。

**4. `models/priestley_taylor.py`:**

- **实现 `PTJPL(PriestleyTaylorBase)`:**

  - 实现 `compute_et` 方法来对三个组分求和：`ET = T + Es + Ei`。

  - 实现 `partition_components` 以返回 $T$, $E_s$ 和 $E_i$。

  - 核心逻辑在于使用 $f$-因子计算三个组分：

    alpha_term = 1.26 * (delta / (delta + gamma)) * (Rnc 或 Rns)

    - `Ei = f_wet * alpha_term`
    - `Es = (f_wet + (1 - f_wet) * f_sm) * alpha_term_soil`
    - `T = (1 - f_wet) * f_C * f_T * f_M * alpha_term_canopy`

  - 为每个 $f$-因子实现私有方法：

    - `_calc_f_wet(RH)`: `return RH**4`
    - `_calc_f_sm(VPD, RH_min)`: `return (RH_min / (VPD / beta))`
    - `_calc_f_C(fAPAR, fIPAR)`: `return fAPAR / fIPAR`
    - `_calc_f_T(Tmax, Topt)`: `return exp(-((Tmax - Topt) / Topt)**2)`
    - `_calc_f_M(fAPAR, fAPAR_max)`: `return fAPAR / fAPAR_max`

- **实现 `GLEAM(PriestleyTaylorBase)`:**

  - 这是一个概念性的实现。将 compute_et 实现为：

    potential_et = 1.26 * (delta / (delta + gamma)) * (Rn - G)

  - `stress_factor = self._compute_stress_factor(ds)`

  - `AET = potential_et * stress_factor`

  - `_compute_stress_factor(self, ds)`: 在文档字符串中解释，此函数在真实的GLEAM实现中会使用微波土壤湿度 (用于 $E_s$) 和 VOD (用于 $T$) 来推导胁迫因子 $S$。对于此模拟，可以使用土壤湿度的简单线性函数：`S = ds['soil_moisture'] / ds['soil_moisture_max']`。

**5. `models/energy_balance.py`:**

- **实现 `SEBAL(EnergyBalanceBase)`:**

  - `compute_et` 必须实现残差方程：`LE = Rn - G - H`。
  - 核心方法是 `_compute_sensible_heat(self, ds)`:
    1. 在 `ds` 中识别“热”和“冷”像素 (例如，基于NDVI和LST的分位数)。
    2. 设置 $H_{cold} = 0$ (或接近0) 和 $H_{hot} = Rn_{hot} - G_{hot}$。
    3. 计算 $dT_{hot}$ 和 $dT_{cold}$ (这需要在这些点估算 $r_a$)。
    4. 假设 $dT = a \cdot T_s + b$。使用热/冷点求解 `a` 和 `b`。
    5. 将 $dT = a \cdot T_s + b$ 方程应用于所有像素以获得 `ds`。
    6. 使用 `ds` 和 `ds['ra']` 计算所有像素的 `ds['H']`。
    7. 返回 `ds['H']`。

- **实现 `SSEBop(EnergyBalanceBase)`:**

  - compute_et 必须实现 "ET 分数" 方程：

    ETo = pet.fao56_penman_monteith(ds) (调用 PET 模块)

    ETf = self._compute_et_fraction(ds)

    AET = ETf * ETo (或 ETf * k * ETo)

  - 实现 `_compute_et_fraction(self, ds)`:

    1. `Tc = self._compute_cold_limit(ds)` (例如， $T_a$ 的一个函数)
    2. `Th = self._compute_hot_limit(ds, Tc)` (例如， $T_c + d_T$, 其中 $d_T$ 从 $r_a$ 和 $R_n$ 导出)。
    3. `Ts = ds`
    4. `ETf = (Th - Ts) / (Th - Tc)`
    5. 确保 ETf 被限制在  范围内 (`.clip(0, 1)`)。

**6. `models/pet.py`:**

- 创建 Python 函数，以 `xarray.Dataset` 作为输入，并返回 `xarray.DataArray`。

- **`fao56_penman_monteith(ds: xr.Dataset) -> xr.DataArray`:**

  - 实现完整的 FAO-56 方程 (30):

    ETo = (0.408 * delta * (Rn - G) + gamma * (900 / (T + 273)) * u2 * (es - ea)) / (delta + gamma * (1 + 0.34 * u2))

  - 确保所有中间变量 (delta, es, ea, Rn, G) 都是从 `ds` 的输入计算得出的。

- **`hargreaves(ds: xr.Dataset) -> xr.DataArray`:**

  - 实现 Hargreaves 方程：

    Ra =... (实现一个函数，根据 ds 中的纬度和年积日计算地外辐射)。

    ETo = 0.0023 * Ra * (ds + 17.8) * (ds - ds)**0.5

**7. `simulation.py`:**

Python

```
import xarray as xr
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# 导入我们所有的新模型
from models.penman_monteith import MOD16, PMLv2
from models.priestley_taylor import PTJPL, GLEAM
from models.energy_balance import SSEBop
from models.pet import fao56_penman_monteith, hargreaves

def create_simulation_data() -> xr.Dataset:
    """创建一个用于模拟的伪数据集。"""
    days = pd.date_range(start="2023-01-01", periods=365, freq="D")
    lats = np.arange(40.0, 40.1, 0.1)
    lons = np.arange(-105.1, -105.0, 0.1)
    
    # 生成现实的模拟数据
    time_var = xr.DataArray(days, dims=["time"])
    # 模拟季节周期
    seasonal_cycle = np.sin(np.linspace(0, 2 * np.pi, 365))
    
    data_vars = {
        "T_mean": (["time", "lat", "lon"], np.random.rand(365, 1, 1) * 15 + 10 + seasonal_cycle[:, None, None] * 10),
        "T_max": (["time", "lat", "lon"], np.random.rand(365, 1, 1) * 5 + 15 + seasonal_cycle[:, None, None] * 12),
        "T_min": (["time", "lat", "lon"], np.random.rand(365, 1, 1) * 5 + 5 + seasonal_cycle[:, None, None] * 8),
        "RH": (["time", "lat", "lon"], np.clip(np.random.rand(365, 1, 1) * 30 + 50 - seasonal_cycle[:, None, None] * 20, 10, 90)),
        "VPD": (["time", "lat", "lon"], np.clip(np.random.rand(365, 1, 1) * 1 + 0.5 + seasonal_cycle[:, None, None] * 1.5, 0.1, 5.0)),
        "Rn": (["time", "lat", "lon"], np.clip(np.random.rand(365, 1, 1) * 50 + 150 + seasonal_cycle[:, None, None] * 100, 0, 400)),
        "G": (["time", "lat", "lon"], np.random.rand(365, 1, 1) * 20 + 10),
        "u2": (["time", "lat", "lon"], np.random.rand(365, 1, 1) * 3 + 1),
        "LAI": (["time", "lat", "lon"], np.clip(np.random.rand(365, 1, 1) * 1 + 1 + seasonal_cycle[:, None, None] * 3, 0.1, 6)),
        "fAPAR": (["time", "lat", "lon"], np.clip(np.random.rand(365, 1, 1) * 0.1 + 0.1 + seasonal_cycle[:, None, None] * 0.7, 0.1, 0.9)),
        "fIPAR": (["time", "lat", "lon"], np.clip(np.random.rand(365, 1, 1) * 0.1 + 0.1 + seasonal_cycle[:, None, None] * 0.8, 0.1, 0.95)),
        "LST": (["time", "lat", "lon"], np.random.rand(365, 1, 1) * 15 + 12 + seasonal_cycle[:, None, None] * 11),
        "soil_moisture": (["time", "lat", "lon"], np.clip(np.random.rand(365, 1, 1) * 0.2 + 0.1 + (1 - seasonal_cycle[:, None, None]) * 0.1, 0.05, 0.4)),
    }
    
    ds = xr.Dataset(data_vars, coords={"time": days, "lat": lats, "lon": lons})
    # 添加静态参数
    ds = (["lat", "lon"], [[10.0]]) # 示例 BPLUT 参数
    ds = (["lat", "lon"], [[25.0]]) # 示例 PT-JPL 参数
    ds["soil_moisture_max"] = (["lat", "lon"], [[0.45]])
    
    return ds

def run_comparison():
    print("1. 创建模拟输入数据集...")
    sim_data = create_simulation_data()
    
    print("2. 初始化ET模型...")
    # 用它们的特定参数初始化模型 (这里作为示例)
    # MOD16的BPLUT参数被假设性地传递
    mod16 = MOD16(bplut_params={'g_lbl': 10.0}) 
    pmlv2 = PMLv2()
    ptjpl = PTJPL(T_opt=25.0, fAPAR_max=0.9)
    gleam = GLEAM(soil_moisture_max=0.45)
    ssebop = SSEBop()
    
    models_to_run = {
        "MOD16": mod16,
        "PMLv2": pmlv2,
        "PTJPL": ptjpl,
        "GLEAM": gleam,
        "SSEBop": ssebop,
    }
    
    results = {}
    
    print("3. 运行PET模型...")
    results = fao56_penman_monteith(sim_data)
    results = hargreaves(sim_data)
    
    print("4. 运行AET模型...")
    for name, model in models_to_run.items():
        print(f"... 正在运行 {name}")
        try:
            et_result = model.compute_et(sim_data)
            results[name] = et_result
        except Exception as e:
            print(f"运行 {name} 时出错: {e}")

    print("5. 正在收集结果...")
    # 将所有结果合并到一个数据集中
    final_ds = xr.Dataset(results)
    
    print(final_ds)
    
    # 绘制结果
    print("6. 正在创建比较图...")
    plt.figure(figsize=(15, 8))
    for var in final_ds.data_vars:
        # 绘制第一个像素的时间序列
        final_ds[var].isel(lat=0, lon=0).plot(label=var)
    plt.title("ET模型时间序列比较")
    plt.ylabel("蒸散发 (mm/天)")
    plt.legend()
    plt.grid(True)
    plt.savefig("et_model_comparison.png")
    print("图表已保存为 'et_model_comparison.png'")

if __name__ == "__main__":
    run_comparison()
```

------